import{z as G,r as o,aX as V,a as j,bE as q,b as e,cm as J,bF as R,cn as X,b2 as Y,co as K,Q as Z,S as M,cp as ee,g as ae,an as te,A as se,cq as re,cr as oe,ax as ne,a5 as le,aB as ce,aC as ie,ay as me,aD as he,d as S,O as $,f as D,bf as L,aH as ue,h as W,aE as de,ad as B,M as pe,N as ge,T as fe,am as ye,G as A,cs as Ce}from"./index-DJgK6ZLj.js";import{T as Te}from"./TeamCard-DG2xjyKS.js";import{d as P}from"./Upload-CP1HgJdf.js";import"./useTeamChar-CxHgrHAy.js";import"./TeamDelModal-DMG6IKBB.js";function xe({teamIds:s,charKeys:r,setCharKey:m,acProps:c}){const{t:h}=G(["page_team","sillyWisher_charNames","charNames_gen"]),{silly:d}=o.useContext(V),n=j(),{gender:g}=q(),p=o.useCallback(t=>n.charMeta.get(t).favorite,[n.charMeta]),F=o.useCallback(t=>e(J,{characterKey:t}),[]),y=o.useCallback((t,u)=>h(`${u?"sillyWisher_charNames":"charNames_gen"}:${R(t,g)}`),[g,h]),b=ae,w=X(n.chars),{characterTeamTotal:C}=o.useMemo(()=>Y({characterTeamTotal:w},u=>{n.teams.values.forEach(f=>{const{loadoutData:l}=f;l.filter(K).forEach(({teamCharId:T})=>{const v=n.teamChars.get(T);if(!v)return;const x=v.key;u.characterTeamTotal[x].total++})}),s.forEach(f=>{const l=n.teams.get(f);if(!l)return;const{loadoutData:T}=l;T.filter(K).forEach(({teamCharId:v})=>{const x=n.teamChars.get(v);if(!x)return;const N=x.key;u.characterTeamTotal[N].current++})})}),[n,w,s]),I=o.useCallback(t=>e("strong",{children:C[t]}),[C]),E=o.useCallback(t=>e(Z,{size:"small",label:C[t]}),[C]),k=o.useMemo(()=>w.map(t=>({key:t,label:y(t,d),alternateNames:d?[y(t,!d)]:void 0,favorite:p(t),color:b(t)})).sort((t,u)=>t.favorite&&!u.favorite?-1:!t.favorite&&u.favorite?1:t.label.localeCompare(u.label)),[d,y,b,p,w]);return e(o.Suspense,{fallback:e(M,{variant:"text",width:100}),children:e(ee,{label:h("searchLabel.char"),options:k,toImg:F,valueKeys:r,onChange:t=>m(t),toExLabel:I,toExItemLabel:E,chipProps:{variant:"outlined"},...c})})}function be(){return{name:s=>s.name??"",lastEdit:s=>s.lastEdit??0}}const we={name:["name","lastEdit"],lastEdit:["lastEdit"]};function ve(s){return{charKeys:(r,m)=>{var n;if(!m.length)return!0;const c=(n=s.teams.get(r))==null?void 0:n.loadoutData.filter(K),h=c==null?void 0:c.map(({teamCharId:g})=>{var p;return(p=s.teamChars.get(g))==null?void 0:p.key}).filter(K);return m.every(g=>h==null?void 0:h.includes(g))},name:(r,m)=>{var c;return!m||!!((c=s.teams.get(r))!=null&&c.name.toLowerCase().includes(m.toLowerCase()))}}}const Se={xs:1,sm:2,md:2,lg:3,xl:3},Ie={xs:6,sm:12,md:18,lg:24,xl:24};function Ke(){const{t:s}=G(["page_team","page_teams","sillyWisher_charNames","charNames_gen"]),r=j(),[m,c]=te(),h=se(),d=re();o.useEffect(()=>r.teams.followAny((a,i)=>(i==="new"||i==="remove"||i==="update")&&c()),[c,r]),oe();const n=()=>{const a=r.teams.new();h(a)},[g,p,F]=ne(),[y,b]=o.useState("");o.useEffect(()=>{var a,i;(a=d.state)!=null&&a.openImportModal&&(b((i=d.state)==null?void 0:i.teamData),p())},[d.state,p,b]);const w=()=>{try{const a=JSON.parse(y);r.teams.import(a)||window.alert(s("importForm.error.verifi")),F()}catch(a){window.alert(s("importForm.error.import")+`
${a}`);return}},C=le(r.displayTeam),{sortType:I,ascending:E,charKeys:k}=C,[t,u]=o.useState(C.searchTerm),f=o.useDeferredValue(t);o.useEffect(()=>{r.displayTeam.set({searchTerm:f})},[r,f]);const{teamIds:l,totalTeamNum:T}=o.useMemo(()=>{const a=r.teams.keys.length,i=r.teams.keys.filter(ce({charKeys:k,name:f},ve(r))).sort((z,Q)=>ie(we[I],E,be())(r.teams.get(z),r.teams.get(Q)));return m&&{teamIds:i,totalTeamNum:a}},[m,r,k,f,I,E]),v=me(),{numShow:x,setTriggerElement:N}=he(Ie[v],l.length),_=o.useMemo(()=>l.slice(0,x),[l,x]),H=l.length!==T?`${l.length}/${T}`:`${T}`,O={numShowing:_.length,total:H,t:s,namespace:"page_teams"},U={sortKeys:[...Ce],value:I,onChange:a=>r.displayTeam.set({sortType:a}),ascending:E,onChangeAsc:a=>r.displayTeam.set({ascending:a})};return S(D,{display:"flex",flexDirection:"column",gap:1,children:[e(W,{children:S($,{sx:{display:"flex",flexDirection:"column",gap:1},children:[S(D,{display:"flex",gap:1,alignItems:"stretch",children:[e(xe,{teamIds:l,charKeys:k,setCharKey:a=>r.displayTeam.set({charKeys:a}),acProps:{sx:{flexGrow:1}}}),e(L,{autoFocus:!0,value:t,onChange:a=>u(a.target.value),label:s("searchLabel.team"),sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(D,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(ue,{showingTextProps:O,sortByButtonProps:U})})]})}),S(D,{sx:{display:"flex",gap:1},children:[e(B,{fullWidth:!0,onClick:n,color:"info",startIcon:e(de,{}),children:s("addTeamBtn")}),e(ye,{open:g,onClose:F,children:S(W,{children:[e(pe,{title:s("importForm.title")}),e(ge,{}),S($,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(fe,{children:s("importForm.desc")}),e(L,{fullWidth:!0,label:s("importForm.label"),placeholder:s("importForm.placeholder"),value:y,onChange:a=>b(a.target.value),multiline:!0,rows:4}),e(B,{startIcon:e(P,{}),disabled:!y,onClick:w,children:s("importForm.importBtn")})]})]})}),e(B,{fullWidth:!0,onClick:p,color:"info",startIcon:e(P,{}),children:s("importTeamBtn")})]}),e(o.Suspense,{fallback:e(M,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(A,{container:!0,spacing:2,columns:Se,children:_.map(a=>e(A,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(M,{variant:"rectangular",width:"100%",height:150}),children:e(Te,{teamId:a,bgt:"light",onClick:i=>h(`${a}${i?`/${i}`:""}`)})})},a))})}),l.length!==_.length&&e(M,{ref:a=>{a&&N(a)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Ke as default};
