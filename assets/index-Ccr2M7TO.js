import{z as _,b as e,d as a,ab as ne,ap as qe,a as $,A as N,r as o,bq as re,f as u,G as d,h as w,bL as Ge,bM as ze,bN as Ve,bO as Ue,W as Ce,bm as He,bP as Qe,ag as ue,Z as Xe,bQ as pe,bR as Ye,bS as ae,M as L,ak as se,al as H,N as W,O as E,T as B,bT as Ze,bU as O,bV as K,p as Q,e as P,bW as be,a9 as Je,bX as et,ad as k,ah as le,am as ie,ax as ve,bY as tt,bZ as at,o as nt,b_ as me,b$ as rt,c0 as st,aq as lt,aE as X,c1 as it,c2 as ct,c3 as Te,bB as ot,v as we,w as Se,j as De,t as G,bE as ce,c4 as dt,aX as Me,bF as ht,c5 as ge,c6 as ut,c7 as pt,D as ke,c8 as fe,E as mt,J as gt,c9 as ft,ca as xe,cb as xt,S as q,i as yt,l as Ct,cc as bt,bv as vt,cd as Tt,ay as wt,an as St,aa as Dt,aB as Mt,aC as kt,b1 as te,aD as It,b4 as Et,ce as _t,cf as jt,bf as $t,aH as Wt,cg as Bt,ch as Ie,ci as At,cj as Ot,I as Lt,H as Nt,g as Rt,F as Ft,ck as Kt,cl as Pt}from"./index-DJgK6ZLj.js";import{u as qt,B as Ee,a as _e,L as Gt,b as zt,T as Vt,c as Ut,C as Ht,d as Qt,e as Xt,f as Yt,E as Zt,g as ye}from"./LoadoutInfoAlert-DUp3cf_q.js";import{T as je}from"./TeamCard-DG2xjyKS.js";import{u as Jt}from"./useTeamChar-CxHgrHAy.js";import{O as ea,L as ta}from"./TeamDelModal-DMG6IKBB.js";function aa(){const{t}=_("page_character");return e(qe,{severity:"warning",children:a(ne,{t,i18nKey:"noLoadout",children:["Looks like you haven't added any loadout/Teams with this character yet. You need to create a loadout+team with this character to"," ",e("strong",{children:"create builds"}),", ",e("strong",{children:"theorycraft"}),", or"," ",e("strong",{children:"optimize"}),"."]})})}function na(){const t=$(),s=N();return o.useCallback(n=>{t.chars.get(n)||t.chars.getWithInitWeapon(n),s(`/characters/${n}`)},[s,t])}function ra({buildId:t,characterKey:s}){const{name:r,description:n,weaponId:l,artifactIds:p}=qt(t),h=re(s).weaponType;return e(Ee,{name:r,description:n,hideFooter:!0,children:e(u,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch"},children:a(d,{container:!0,spacing:1,columns:{xs:2,sm:2,md:2,lg:3,xl:3},children:[e(d,{item:!0,xs:1,children:e(w,{sx:{height:"100%",maxHeight:"8em"},children:e(Ge,{weaponId:l,weaponTypeKey:h})})}),Object.entries(p).map(([g,y])=>e(d,{item:!0,xs:1,children:e(w,{sx:{height:"100%",maxHeight:"8em"},children:e(ze,{artifactId:y,slotKey:g})})},y||g))]})})})}function sa({buildTcId:t}){const s=_e(t),{name:r,description:n}=s;return e(Ee,{name:r,description:n,hideFooter:!0,children:e(la,{buildTcId:t})})}function la({buildTcId:t}){const{weapon:s,artifact:{slots:r,substats:{stats:n},sets:l}}=_e(t),p=Ve(s.key),h=Object.entries(n),g=h.slice(0,5),y=h.slice(5);return e(u,{children:a(d,{container:!0,spacing:1,columns:{xs:2,sm:2,md:2,lg:2,xl:2},children:[e(d,{item:!0,xs:1,children:a(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e(Ue,{weapon:s,weaponSheet:p}),!!Object.keys(l).length&&e(w,{sx:{flexGrow:1},children:e(u,{sx:{p:1,display:"flex",flexDirection:"column",gap:1},children:Object.entries(l).map(([i,c])=>a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Ce,{size:2,src:He(i,"flower")}),e("span",{children:e(Qe,{setKey:i})}),a(ue,{children:["x",c]})]},i))})})]})}),e(d,{item:!0,xs:1,children:e(w,{sx:{flexGrow:1,height:"100%",p:1,display:"flex",flexDirection:"column",gap:1,justifyContent:"space-between"},children:Object.entries(r).map(([i,{level:c,statKey:f}])=>a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Xe,{slotKey:i}),a(ue,{children:["+",c]}),e(pe,{statKey:f})]},i))})}),[g,y].map((i,c)=>e(d,{item:!0,xs:1,children:e(w,{sx:{flexGrow:1,height:"100%"},children:e(u,{sx:{p:1,height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",gap:1},children:i.map(([f,b])=>a(u,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"space-between"},children:[e(pe,{statKey:f}),a("span",{children:[Ye(b,ae(f)),ae(f)]})]},f))})})},c))]})})}function ia({show:t,onHide:s,teamCharId:r,onDelete:n,teamIds:l,conditionalCount:p}){const{t:h}=_("loadout"),g=$(),{name:y,description:i,buildIds:c,buildTcIds:f,customMultiTargets:b,bonusStats:T}=g.teamChars.get(r),D=o.useCallback(()=>{s(),n()},[n,s]);return e(ie,{open:t,onClose:s,containerProps:{maxWidth:"md"},children:a(w,{children:[e(L,{title:e("span",{children:a(ne,{t:h,i18nKey:"loadoutDelModal.title",name:y,children:["Delete Loadout: ",e("strong",{children:{name:y}}),"?"]})}),action:e(se,{onClick:s,children:e(H,{})})}),e(W,{}),a(E,{children:[i&&e(w,{bgt:"dark",sx:{mb:2},children:e(E,{children:i})}),e(B,{children:h("loadoutDelModal.desc")}),a(Ze,{sx:{listStyleType:"disc",pl:4},children:[!!c.length&&e(O,{sx:{display:"list-item"},children:a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[h("loadoutDelModal.builds"),c.length," ",e(K,{title:e(u,{children:c.map(x=>{var v;return a(B,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Q,{}),e("span",{children:(v=g.builds.get(x))==null?void 0:v.name})]},x)})}),children:e(P,{})})]})}),!!f.length&&e(O,{sx:{display:"list-item"},children:a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[h("loadoutDelModal.tcBuilds"),f.length," ",e(K,{title:e(u,{children:f.map(x=>{var v;return a(B,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Q,{}),e("span",{children:(v=g.buildTcs.get(x))==null?void 0:v.name})]},x)})}),children:e(P,{})})]})}),!!b.length&&e(O,{sx:{display:"list-item"},children:a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[h("loadoutDelModal.mTargets"),b.length," ",e(K,{title:e(u,{children:b.map((x,v)=>a(B,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(be,{}),e("span",{children:x.name})]},v))}),children:e(P,{})})]})}),!!Object.keys(T).length&&a(O,{sx:{display:"list-item"},children:[h("loadoutDelModal.bonus"),Object.keys(T).length]}),!!p&&a(O,{sx:{display:"list-item"},children:[h("loadoutDelModal.condi"),p]}),e(O,{sx:{display:"list-item"},children:h("loadoutDelModal.optConfig")}),!!l.length&&e(O,{sx:{display:"list-item"},children:a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[a("span",{children:[h("loadoutDelModal.affected"),l.length]}),e(K,{title:e(u,{children:l.map(x=>{var v;return a(B,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Je,{}),e("span",{children:(v=g.teams.get(x))==null?void 0:v.name})]},x)})}),children:e(P,{})})]})})]})]}),a(et,{sx:{float:"right"},children:[e(k,{startIcon:e(H,{}),color:"secondary",onClick:s,children:h("loadoutDelModal.cancel")}),e(k,{startIcon:e(le,{}),color:"error",onClick:D,children:h("loadoutDelModal.delete")})]})]})})}function ca({show:t,onHide:s,teamCharId:r,teamIds:n}){const{t:l}=_("loadout"),[p,h,g]=ve(),y=N(),i=$(),{key:c,name:f,description:b,buildIds:T,buildTcIds:D,customMultiTargets:x,bonusStats:v,optConfigId:z,conditional:R}=Jt(r),{optimizationTarget:S}=tt(z),F=()=>{s(),i.teamChars.remove(r)},Y=()=>{i.teamChars.duplicate(r)&&s()},Z=C=>{const j=i.teams.new();i.teams.set(j,J=>{J.loadoutData[0]={teamCharId:C}}),y(`/teams/${j}`)},V=o.useMemo(()=>{let C=0;return at(R,[],j=>typeof j!="object",()=>C++),C},[R]);return e(ie,{open:t,onClose:s,containerProps:{maxWidth:"lg"},children:a(w,{children:[e(L,{title:a(u,{display:"flex",gap:1,alignItems:"center",children:[e(nt,{}),e("strong",{children:f})]}),action:e(se,{onClick:s,children:e(H,{})})}),e(W,{}),a(E,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(Gt,{}),e(me,{fullWidth:!0,label:l("loadoutEditor.label"),placeholder:l("loadoutEditor.placeholder"),value:f,onChange:C=>i.teamChars.set(r,{name:C})}),e(me,{fullWidth:!0,label:l("loadoutEditor.desc"),value:b,onChange:C=>i.teamChars.set(r,{description:C}),multiline:!0,minRows:2}),e(u,{children:a(d,{container:!0,columns:{xs:1,md:2},spacing:2,children:[e(d,{item:!0,xs:1,children:e(k,{color:"info",onClick:()=>Y(),fullWidth:!0,startIcon:e(rt,{}),children:l("loadoutEditor.dupBtn")})}),a(d,{item:!0,xs:1,children:[e(ia,{show:p,onHide:g,onDelete:F,teamCharId:r,teamIds:n,conditionalCount:V}),e(k,{fullWidth:!0,startIcon:e(le,{}),color:"error",onClick:h,children:l("loadoutEditor.delBtn")})]})]})}),e(u,{children:a(d,{container:!0,columns:{xs:1,md:2},spacing:2,children:[!!Object.keys(v).length&&e(d,{item:!0,xs:1,children:e(oa,{bonusStats:v})}),!!S&&e(d,{item:!0,xs:1,children:a(w,{bgt:"light",children:[e(L,{title:a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(st,{}),e("span",{children:l("loadoutEditor.optTarget")})]})}),e(W,{}),e(E,{children:e(lt,{divider:e(W,{orientation:"vertical",flexItem:!0}),spacing:1,children:e(ea,{optimizationTarget:S,customMultiTargets:x})})})]})}),!!x.length&&e(d,{item:!0,xs:1,children:e(da,{customMultiTargets:x})}),e(d,{item:!0,xs:1,children:e(w,{bgt:"light",children:e(E,{children:a(B,{variant:"h6",children:[l("loadoutEditor.conditionals"),e("strong",{children:V})]})})})})]})})]}),e(W,{}),e(L,{title:a(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(Q,{}),e("span",{children:l("loadoutEditor.builds")})]})}),e(W,{}),a(E,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(zt,{}),e(u,{children:e(d,{container:!0,columns:{xs:1,md:2},spacing:2,children:T.map(C=>e(d,{item:!0,xs:1,children:e(ra,{buildId:C,characterKey:c})},C))})}),e(Vt,{}),e(u,{children:e(d,{container:!0,columns:{xs:1,md:2},spacing:2,children:D.map(C=>e(d,{item:!0,xs:1,children:e(sa,{buildTcId:C})},C))})})]}),e(W,{}),e(L,{title:a(u,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e(Q,{}),e("span",{children:l("loadoutEditor.teams")})]})}),e(W,{}),a(E,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(Ut,{}),a(d,{container:!0,columns:{xs:1,md:2},spacing:2,children:[n.map(C=>e(d,{item:!0,xs:1,children:e(je,{bgt:"light",teamId:C,onClick:j=>y(`/teams/${C}${j?`/${j}`:""}`)})},C)),e(d,{item:!0,xs:1,children:e(k,{fullWidth:!0,sx:{height:"100%",backgroundColor:"contentLight.main"},variant:"outlined",onClick:()=>Z(r),color:"info",startIcon:e(X,{}),children:l("loadoutEditor.addNewTeam")})})]})]})]})})}function oa({bonusStats:t}){const{t:s}=_("loadout");return a(w,{bgt:"light",children:[e(L,{title:a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(it,{}),e("span",{children:s("loadoutEditor.bonusStats")})]}),titleTypographyProps:{variant:"h6"}}),e(Te,{bgt:"light",sections:[{fields:Object.entries(t).map(([r,n])=>({text:ct.getStr(r)??r,value:n,unit:ae(r)}))}]})]})}function da({customMultiTargets:t}){const{t:s}=_("loadout");return a(w,{bgt:"light",children:[e(L,{title:a(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(be,{}),e("span",{children:s("loadoutEditor.mltTargets")})]}),titleTypographyProps:{variant:"h6"}}),e(Te,{bgt:"light",sections:[{fields:t.map(({name:r,description:n})=>({text:r,value:n?e(K,{title:n,children:e(P,{})}):void 0}))}]})]})}const ha={xs:1,md:2};function ua({teamCharId:t,teamIds:s}){const{t:r}=_("page_character"),n=N(),l=$(),p=i=>{const c=l.teams.new();l.teams.set(c,f=>{f.loadoutData[0]={teamCharId:i}}),n(`/teams/${c}`)},[h,g,y]=ve();return a(ot,{children:[e(ca,{show:h,onHide:y,teamCharId:t,teamIds:s}),a(w,{bgt:"light",children:[e(k,{fullWidth:!0,onClick:g,sx:{p:0,display:"flex",borderBottomLeftRadius:0,borderBottomRightRadius:0},color:"neutral100",variant:"outlined",children:e(ta,{teamCharId:t,showSetting:!0})}),e(E,{sx:{p:1},children:a(d,{container:!0,columns:ha,spacing:1,children:[s.map(i=>e(d,{item:!0,xs:1,children:e(je,{teamId:i,onClick:c=>n(`/teams/${i}${c?`/${c}`:""}`)})},i)),e(d,{item:!0,xs:1,children:e(k,{fullWidth:!0,sx:{height:"100%",backgroundColor:"contentNormal.main"},variant:"outlined",onClick:()=>p(t),color:"info",startIcon:e(X,{}),children:r("charContentModal.addTeam")})})]})})]},t)]})}var oe={},pa=Se;Object.defineProperty(oe,"__esModule",{value:!0});var $e=oe.default=void 0,ma=pa(we()),ga=De;$e=oe.default=(0,ma.default)((0,ga.jsx)("path",{d:"M17.5 9.5C17.5 6.46 15.04 4 12 4S6.5 6.46 6.5 9.5c0 2.7 1.94 4.93 4.5 5.4V17H9v2h2v2h2v-2h2v-2h-2v-2.1c2.56-.47 4.5-2.7 4.5-5.4m-9 0C8.5 7.57 10.07 6 12 6s3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5"}),"Female");var de={},fa=Se;Object.defineProperty(de,"__esModule",{value:!0});var We=de.default=void 0,xa=fa(we()),ya=De;We=de.default=(0,xa.default)((0,ya.jsx)("path",{d:"M9.5 11c1.93 0 3.5 1.57 3.5 3.5S11.43 18 9.5 18 6 16.43 6 14.5 7.57 11 9.5 11m0-2C6.46 9 4 11.46 4 14.5S6.46 20 9.5 20s5.5-2.46 5.5-5.5c0-1.16-.36-2.23-.97-3.12L18 7.42V10h2V4h-6v2h2.58l-3.97 3.97C11.73 9.36 10.66 9 9.5 9"}),"Male");function Ca(){const{t}=_("ui"),s=$(),{character:r}=o.useContext(G),{key:n}=r,{gender:l}=ce(),p=o.useCallback(()=>s.dbMeta.set({gender:l==="F"?"M":"F"}),[l,s]);return n.startsWith("Traveler")?a(k,{onClick:p,startIcon:l==="F"?e($e,{}):e(We,{}),children:[e("strong",{children:t(`gender.${l}`)})," "]}):null}function ba({onClose:t}){const{t:s}=_(["page_character","sillyWisher_charNames","charNames_gen"]),r=N(),n=$(),{character:l,character:{key:p}}=o.useContext(G),{gender:h}=ce(),g=dt(p,h),{silly:y}=o.useContext(Me),i=o.useCallback(async()=>{const c=s(`${y?"sillyWisher_charNames":"charNames_gen"}:${ht(p,h)}`);window.confirm(s("removeCharacter",{value:c}))&&(n.chars.remove(p),r("/characters"))},[n,r,p,h,y,s]);return a(u,{display:"flex",flexDirection:"column",gap:1,children:[a(u,{display:"flex",gap:1,children:[e(Ca,{}),e(k,{color:"error",onClick:()=>i(),startIcon:e(le,{}),sx:{marginLeft:"auto"},children:s("delete")}),!!t&&e(se,{onClick:t,children:e(H,{})})]}),e(u,{children:a(d,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[e(d,{item:!0,xs:8,sm:5,md:4,lg:3,children:a(w,{bgt:"light",sx:{height:"100%",display:"flex",flexDirection:"column",gap:1},children:[e(Ht,{}),e(u,{sx:{px:1},children:e(Qt,{level:l.level,ascension:l.ascension,setBoth:c=>{ge.includes(p)?ge.forEach(f=>{n.chars.set(f,c)}):n.chars.set(p,c)}})}),e(ut,{bgt:"light"}),e(B,{sx:{textAlign:"center",pb:-1},variant:"h6",children:e(pt,{characterKey:p,gender:h})}),e(u,{sx:{px:1},children:e(Xt,{setConstellation:c=>n.chars.set(p,{constellation:c})})})]})}),a(d,{item:!0,xs:12,sm:7,md:8,lg:9,sx:{display:"flex",flexDirection:"column",gap:1},children:[e(u,{children:e(d,{container:!0,columns:3,spacing:1,children:["auto","skill","burst"].map(c=>{var f;return e(d,{item:!0,xs:1,children:e(Yt,{talentKey:c,dropDownButtonProps:{startIcon:e(Ce,{src:(f=g.getTalentOfKey(c))==null?void 0:f.img,size:1.75,sideMargin:!0})},setTalent:b=>n.chars.set(p,T=>{T.talent[c]=b})},c)},c)})})}),e(va,{}),e(Ta,{})]})]})})]})}function va(){const{character:{key:t,equippedArtifacts:s}}=o.useContext(G),{data:r}=o.useContext(ke),n=$(),l=re(t).weaponType,p=r.get(fe.weapon.id).value,h=o.useMemo(()=>mt(gt,g=>r.get(fe.art[g].id).value),[r]);return e(u,{children:e(ft.Provider,{value:"equipped",children:e(Zt,{weaponTypeKey:l,weaponId:p,artifactIds:h,setWeapon:g=>{n.weapons.set(g,{location:xe(t)})},setArtifact:(g,y)=>{y?n.arts.set(y,{location:xe(t)}):n.arts.set(s[g],{location:""})}})})})}function Ta(){const{t}=_("page_character"),s=N(),{character:{key:r}}=o.useContext(G),n=$(),{gender:l}=ce(),p=ye(n.teamChars),h=ye(n.teams),g=o.useMemo(()=>{const i={};return[...p].sort((b,T)=>{const[,D]=b,[,x]=T;return D.name.localeCompare(x.name)}).map(([b,T])=>{T.key===r&&(i[b]||(i[b]=[]))}),[...h].sort((b,T)=>{const[,D]=b,[,x]=T;return D.name.localeCompare(x.name)}).forEach(([b,T])=>{const D=T.loadoutData.find(x=>{var v;return x&&((v=n.teamChars.get(x==null?void 0:x.teamCharId))==null?void 0:v.key)===r});D&&i[D==null?void 0:D.teamCharId].push(b)}),i},[p,h,r,n.teamChars]),y=()=>{const i=n.teams.new(),c=n.teamChars.new(r);n.teams.set(i,f=>{f.loadoutData[0]={teamCharId:c}}),s(`/teams/${i}`)};return a(u,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e(B,{variant:"h6",children:a(ne,{t,i18nKey:"charContentModal.loadoutsWith",children:["Team Loadouts with"," ",e(xt,{characterKey:r,gender:l})]})}),!Object.values(g).length&&e(aa,{}),Object.entries(g).map(([i,c])=>e(ua,{teamCharId:i,teamIds:c},i)),e(k,{fullWidth:!0,onClick:()=>y(),color:"info",startIcon:e(X,{}),variant:"outlined",sx:{backgroundColor:"contentLight.main"},children:t("charContentModal.addLoAndTeam")}),e(w,{bgt:"light"})]})}function wa({characterKey:t,onClose:s}){return e(ie,{open:!!t,onClose:s,children:e(o.Suspense,{fallback:e(q,{variant:"rectangular",width:"100%",height:1e3}),children:t&&e(Sa,{characterKey:t,onClose:s},t)})})}function Sa({characterKey:t,onClose:s}){const r=yt(t),n=Ct(t),{target:l}=(n==null?void 0:n[t])??{},p=o.useMemo(()=>{if(!(!n||!l))return{data:l,teamData:n,compareData:void 0}},[l,n]),h=o.useMemo(()=>r&&{character:r},[r]),[g,y]=o.useState(),[i,c]=o.useState(),f=o.useMemo(()=>({chartData:g,setChartData:y,graphBuilds:i,setGraphBuilds:c}),[g,i]);return o.useEffect(()=>{y(void 0),c(void 0)},[t]),e(w,{children:e(E,{sx:{display:"flex",flexDirection:"column",gap:1},children:e(o.Suspense,{fallback:e(q,{variant:"rectangular",width:"100%",height:1e3}),children:p&&h&&f?e(G.Provider,{value:h,children:e(ke.Provider,{value:p,children:e(bt.Provider,{value:f,children:e(ba,{onClose:s})})})}):e(q,{variant:"rectangular",width:"100%",height:1e3})})})})}const Da={xs:1,sm:2,md:3,lg:4,xl:4},Ma={xs:5,sm:8,md:9,lg:12,xl:12},ka=Object.keys(Ie);function Wa(){const t=$(),s=N(),{params:{characterKey:r}}=vt({path:"/characters/:characterKey",end:!1})??{params:{}},n=o.useMemo(()=>r?Tt(r)?(t.chars.get(r)||t.chars.getWithInitWeapon(r),r):(s("/characters"),null):null,[r,s,t]),{t:l}=_(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:p}=o.useContext(Me),[h,g]=o.useState(()=>t.displayCharacter.get());o.useEffect(()=>t.displayCharacter.follow((m,M)=>g(M)),[t,g]);const[y,i]=o.useState(""),c=o.useDeferredValue(y),f=wt(),[b,T]=o.useState(!1),[D,x]=St();o.useEffect(()=>(Dt.send({hitType:"pageview",page:"/characters"}),t.chars.followAny((m,M)=>(M==="new"||M==="remove")&&x())),[x,t]),o.useEffect(()=>t.charMeta.followAny(m=>x()),[x,t]);const v=na(),z=o.useDeferredValue(h),R=o.useDeferredValue(D),{charKeys:S,totalCharNum:F}=o.useMemo(()=>{const M=t.chars.keys.length,{element:A,weaponType:I,rarity:U,sortType:Fe,ascending:Ke}=z,Pe=t.chars.keys.filter(Mt({element:A,weaponType:I,rarity:U,name:c},At(t,p))).sort(kt(Ie[Fe]??[],Ke,Ot(t,p),["new","favorite"]));return R&&{charKeys:Pe,totalCharNum:M}},[t,z,c,p,R]),{weaponType:Y,element:Z,rarity:V,sortType:C,ascending:j}=h,J=o.useMemo(()=>te(Nt,m=>Object.entries(t.chars.data).forEach(([M,A])=>{const I=t.weapons.get(A.equippedWeapon);if(!I)return;const U=Lt(I.key).weaponType;m[U].total++,S.includes(M)&&m[U].current++})),[t,S]),Be=o.useMemo(()=>te(Ft,m=>Object.entries(t.chars.data).forEach(([M,A])=>{const I=Rt(A.key);m[I].total++,S.includes(M)&&m[I].current++})),[t,S]),Ae=o.useMemo(()=>te(Kt,m=>Object.entries(t.chars.data).forEach(([M,A])=>{const I=re(A.key).rarity;m[I].total++,S.includes(M)&&m[I].current++})),[t,S]),{numShow:he,setTriggerElement:Oe}=It(Ma[f],S.length),ee=o.useMemo(()=>S.slice(0,he),[S,he]),Le=S.length!==F?`${S.length}/${F}`:`${F}`,Ne={numShowing:ee.length,total:Le,t:l,namespace:"page_character"},Re={sortKeys:[...ka],value:C,onChange:m=>t.displayCharacter.set({sortType:m}),ascending:j,onChangeAsc:m=>t.displayCharacter.set({ascending:m})};return a(u,{display:"flex",flexDirection:"column",gap:1,children:[n&&e(wa,{characterKey:n,onClose:()=>s("/characters")}),e(o.Suspense,{fallback:!1,children:e(Pt,{newFirst:!0,show:b,onHide:()=>T(!1),onSelect:v})}),e(w,{children:a(E,{sx:{display:"flex",flexDirection:"column",gap:1},children:[a(d,{container:!0,spacing:1,children:[e(d,{item:!0,children:e(Et,{sx:{height:"100%"},onChange:m=>t.displayCharacter.set({weaponType:m}),value:Y,totals:J,size:"small"})}),e(d,{item:!0,children:e(_t,{sx:{height:"100%"},onChange:m=>t.displayCharacter.set({element:m}),value:Z,totals:Be,size:"small"})}),e(d,{item:!0,children:e(jt,{sx:{height:"100%"},onChange:m=>t.displayCharacter.set({rarity:m}),value:V,totals:Ae,size:"small"})}),e(d,{item:!0,flexGrow:1}),e(d,{item:!0,children:e($t,{autoFocus:!0,value:y,onChange:m=>i(m.target.value),label:l("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),e(u,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(Wt,{showingTextProps:Ne,sortByButtonProps:Re})})]})}),e(k,{fullWidth:!0,onClick:()=>T(!0),color:"info",startIcon:e(X,{}),children:l("addNew")}),e(o.Suspense,{fallback:e(q,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(d,{container:!0,spacing:1,columns:Da,children:ee.map(m=>e(d,{item:!0,xs:1,children:e(Bt,{characterKey:m,onClick:()=>s(`${m}`),hideStats:!0})},m))})}),S.length!==ee.length&&e(q,{ref:m=>{m&&Oe(m)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Wa as default};
